# 电商网站秒杀系统设计方案

## 1. 项目概述

### 1.1 项目背景
商品秒杀作为一种营销工具，利用限时限量、先到先得的用户心理，刺激购买或制造机会吸引用户的注意力。本系统实现基础的电商秒杀功能。

### 1.2 项目目标
使用分布式缓存Redis实现电商秒杀抢购功能，掌握Redis在电商场景中的应用。

### 1.3 技术环境
- **Java版本**: OpenJDK 25
- **框架**: Spring Boot 4.0.x
- **数据库**: MySQL 8.0 (端口3306，密码123456)
- **缓存**: Redis (端口6379)
- **构建工具**: Maven 3.9.11
- **部署**: 华为云

## 2. 系统需求分析

### 2.1 功能需求

#### 2.1.1 Redis缓存实例配置
- 创建和配置Redis缓存实例公网访问
- Redis连接池配置优化

#### 2.1.2 电商产品查询
- 商品基本信息查询
- 商品库存查询
- 商品列表展示

#### 2.1.3 电商网站秒杀功能
- 秒杀商品展示
- 秒杀活动时间控制
- 用户秒杀抢购
- 库存扣减
- 订单生成
- 基础防刷机制

#### 2.1.4 电商网站云部署
- 应用打包部署
- 华为云部署配置

### 2.2 非功能需求
- **并发支持**: 支持百级并发用户同时秒杀
- **性能**: 响应时间 < 500ms
- **数据一致性**: 保证库存数据准确性
- **安全性**: 基础防刷机制

## 3. 系统架构设计

### 3.1 整体架构
```
┌─────────────────┐
│   Web浏览器     │
└─────────────────┘
         │
┌─────────────────┐
│  Spring Boot    │
│   Web应用       │
└─────────────────┘
         │
┌─────────────────┐    ┌─────────────────┐
│     Redis       │    │     MySQL       │
│   缓存服务      │    │    数据库       │
└─────────────────┘    └─────────────────┘
```

### 3.2 技术选型

| 组件 | 技术选型 | 版本 | 说明 |
|------|----------|------|------|
| 开发框架 | Spring Boot | 4.0.x | 主开发框架 |
| 数据库 | MySQL | 8.0+ | 主数据存储 |
| 缓存 | Redis | 7.0+ | 缓存服务 |
| ORM框架 | MyBatis Plus | 3.5+ | 数据访问层 |
| 连接池 | HikariCP | 5.0+ | 数据库连接池 |
| 模板引擎 | Thymeleaf | 3.2+ | 前端模板 |
| JSON处理 | Jackson | 2.15+ | JSON序列化 |
| 日志 | Logback | 1.4+ | 日志框架 |

## 4. 数据库设计

### 4.1 核心表结构

#### 4.1.1 商品表 (tb_product)
```sql
CREATE TABLE tb_product (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_name VARCHAR(100) NOT NULL COMMENT '商品名称',
    product_desc TEXT COMMENT '商品描述',
    price DECIMAL(10,2) NOT NULL COMMENT '商品价格',
    stock_count INT NOT NULL DEFAULT 0 COMMENT '库存数量',
    status TINYINT DEFAULT 1 COMMENT '商品状态 1-正常 0-下架',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品表';
```

#### 4.1.2 秒杀商品表 (tb_seckill_product)
```sql
CREATE TABLE tb_seckill_product (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_id BIGINT NOT NULL COMMENT '商品ID',
    seckill_price DECIMAL(10,2) NOT NULL COMMENT '秒杀价格',
    stock_count INT NOT NULL COMMENT '秒杀库存',
    start_time DATETIME NOT NULL COMMENT '秒杀开始时间',
    end_time DATETIME NOT NULL COMMENT '秒杀结束时间',
    status TINYINT DEFAULT 1 COMMENT '状态 1-正常 0-结束',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_product (product_id),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='秒杀商品表';
```

#### 4.1.3 用户表 (tb_user)
```sql
CREATE TABLE tb_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
    password VARCHAR(100) NOT NULL COMMENT '密码',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

#### 4.1.4 秒杀订单表 (tb_seckill_order)
```sql
CREATE TABLE tb_seckill_order (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_no VARCHAR(64) NOT NULL UNIQUE COMMENT '订单号',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    seckill_price DECIMAL(10,2) NOT NULL COMMENT '秒杀价格',
    status TINYINT DEFAULT 0 COMMENT '订单状态 0-成功 1-失败',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user (user_id),
    INDEX idx_product (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='秒杀订单表';
```

## 5. Redis缓存设计

### 5.1 缓存结构设计

#### 5.1.1 商品缓存
```
Key: product:{productId}
Type: Hash
TTL: 30分钟
Fields: {
    id, productName, price, stockCount
}
```

#### 5.1.2 秒杀库存缓存
```
Key: seckill:stock:{seckillId}
Type: String (原子计数器)
TTL: 活动结束时间
Value: 剩余库存数量
```

#### 5.1.3 用户购买记录
```
Key: user:{userId}:seckill:{seckillId}
Type: String
TTL: 活动结束时间
Value: 1 (表示已购买)
```

### 5.2 缓存策略

#### 5.2.1 预热策略
- 秒杀活动开始前将库存数据加载到Redis
- 商品基本信息按需缓存

#### 5.2.2 更新策略
- 使用Redis原子操作扣减库存
- 扣减成功后直接创建订单
- 定时同步库存数据到MySQL

#### 5.2.3 过期策略
- 秒杀活动结束后自动清理缓存
- 用户购买记录自动过期

## 6. 核心功能实现

### 6.1 秒杀流程设计

```
1. 用户点击秒杀按钮
   ↓
2. 检查用户是否登录
   ↓
3. 检查用户是否已购买
   ↓
4. 检查秒杀活动是否开始
   ↓
5. Redis原子扣减库存
   ↓
6. 扣减成功？创建订单
   └─ 否 → 返回失败
```

### 6.2 简单防刷机制

#### 6.2.1 单用户限流
- 使用Redis限制单个用户秒杀频率
- 同一用户1秒内只能请求1次

#### 6.2.2 重复购买检查
- Redis存储用户购买记录
- 防止同一用户重复秒杀同一商品

### 6.3 并发控制

#### 6.3.1 Redis原子操作
```java
// 使用Redis的DECR命令原子扣减库存
Long stock = redisTemplate.opsForValue().decrement("seckill:stock:" + seckillId);
if (stock < 0) {
    // 库存不足，回滚
    redisTemplate.opsForValue().increment("seckill:stock:" + seckillId);
    return false;
}
```

## 7. 接口设计

### 7.1 商品相关接口

#### 7.1.1 获取商品列表
```
GET /products
返回: 商品列表页面
```

#### 7.1.2 获取商品详情
```
GET /product/{id}
返回: 商品详情页面
```

### 7.2 秒杀相关接口

#### 7.2.1 获取秒杀商品列表
```
GET /seckill/list
返回: 秒杀商品列表页面
```

#### 7.2.2 执行秒杀
```
POST /seckill/do
参数: seckillId
返回: 秒杀结果 (成功/失败)
```

### 7.3 用户相关接口

#### 7.3.1 用户登录
```
POST /user/login
参数: username, password
返回: 登录结果
```

#### 7.3.2 用户注册
```
POST /user/register
参数: username, password
返回: 注册结果
```

## 8. 部署方案

### 8.1 本地开发环境

#### 8.1.1 环境要求
- JDK 25
- Maven 3.9+
- MySQL 8.0+
- Redis 7.0+

#### 8.1.2 启动顺序
1. 启动MySQL数据库
2. 启动Redis服务
3. 创建数据库和表结构
4. 启动Spring Boot应用

### 8.2 华为云部署

#### 8.2.1 云服务选型
- **ECS**: 弹性云服务器 (2核4G)
- **RDS**: 云数据库MySQL
- **DCS**: 分布式缓存服务Redis

#### 8.2.2 部署步骤
1. 购买ECS服务器并配置Java环境
2. 创建RDS数据库实例
3. 创建DCS Redis实例
4. 打包应用为JAR文件
5. 上传并运行应用

## 9. 项目实施计划

### 第一阶段：环境搭建 (2天)
- 配置开发环境
- 创建数据库表结构
- 配置Redis连接

### 第二阶段：基础功能 (3天)
- 用户注册登录功能
- 商品管理功能
- 基础页面展示

### 第三阶段：秒杀功能 (3天)
- 秒杀商品管理
- 秒杀核心逻辑实现
- 订单管理功能

### 第四阶段：测试部署 (2天)
- 功能测试
- 华为云部署
- 文档编写

---

*本设计方案适合课程设计项目，重点掌握Redis在秒杀场景中的应用。*